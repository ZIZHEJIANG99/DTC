{{ 'component-cart-recommendations.css' | asset_url | stylesheet_tag }}

<div id="cart-recos" class="cart-recommendations" data-section-id="{{ section.id }}">
  <div id="recommendations-loading">Loading…</div>
  <div id="recommendations-error" style="display:none;">
    {% capture __error_msg %}{{ 'cart_recommendations.error_message' | t }}{% endcapture %}
    {% if __error_msg contains 'Translation missing' %}
      {% assign __error_msg = 'Unable to load recommendations. Please try again.' %}
    {% endif %}
    <p>{{ __error_msg }}</p>

    {% capture __retry_text %}{{ 'cart_recommendations.retry_button' | t }}{% endcapture %}
    {% if __retry_text contains 'Translation missing' %}
      {% assign __retry_text = 'Retry' %}
    {% endif %}
    <button id="recommendations-retry">{{ __retry_text }}</button>
  </div>
  <div id="recommendations-empty" style="display:none;">
    {% capture __empty_msg %}{{ 'cart_recommendations.empty_message' | t }}{% endcapture %}
    {% if __empty_msg contains 'Translation missing' %}
      {% assign __empty_msg = 'No recommendations at this time.' %}
    {% endif %}
    {{ __empty_msg }}
  </div>
  <div id="recommendations-list" class="recommended-list"></div>
</div>

<script>
  window.cartRecommendationsSettings = {
    // 主题编辑器里的接口地址，可为空：
    apiUrl: {{ section.settings.api_endpoint | default: '' | json }},
    // 本地 JSON 兜底数据的 **CDN 正确地址**（关键！）
    fallbackUrl: {{ 'recommended-products-data.json' | asset_url | json }},
    maxProducts: {{ section.settings.max_products | default: 6 | json }},
    strings: {
      addToCart: {{ 'cart_recommendations.add_to_cart' | t | json }},
      error: {{ 'cart_recommendations.error_message' | t | json }},
      retry: {{ 'cart_recommendations.retry_button' | t | json }},
      empty: {{ 'cart_recommendations.empty_message' | t | json }}
    }
  };
</script>

{{ 'cart-recommendations.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Cart Recommendations",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Recommended for you"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "You might also like these discounted products"
    },
    {
      "type": "url",
      "id": "api_endpoint",
      "label": "API Endpoint URL",
      "info": "URL of the API endpoint that returns recommended products JSON. Leave empty to use local demo data.",
      "default": ""
    },
    {
      "type": "range",
      "id": "max_products",
      "label": "Maximum Products",
      "min": 1,
      "max": 20,
      "step": 1,
      "default": 6
    }
  ],
  "presets": [
    {
      "name": "Cart Recommendations"
    }
  ]
}
{% endschema %}